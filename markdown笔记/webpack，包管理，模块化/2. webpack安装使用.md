# webpack安装

## 准备工作

1. ```npm init``` 创建package.json文件

2. ```npm i -D webpack webpack-cli``` 在本地环境下安装

3. ```webpack``` 默认情况下，将 ./src/index.js 作为入口文件分析依赖关系，打包到./dist/bundle.js文件中

4. 在package.json下配置"script" 脚本命令

```json
{
  "script": {
    "build": "webpack",
    "dev": "webpack --mode=development"   //开发时运行npm run dev == webpack
  }
}
```

5. 配置文件webpack.config.js

该配置文件打包过程中参与运行，而运行的环境是node，必须用commonJS规范

node可以解析模块，但是打包的文件不在打包过程中运行,模块语法通过一系列转化成了浏览器可以运行的js代码

```js
const path = require('path');
module.exports = {
  mode: 'development'
  entry: path.resolve(__dirname, "/src/index.js"), //启动模块
  //默认写法：
  // entry：{
  //   main: path.resolve(__dirname, "/src/index.js"),
  // },
  //属性：chunk名，值：入口模块
  output: {
    path: path.resolve(__dirname, "/dist"),    //打包后文件存放的地方
    filename: "bundle.js"   //出口模块
    //配置合并的js文件的规则
    // name方法   [name].js
    // chunkhash方法 [name].[chunkhash:5].js
  }
}
//__dirname是node的一个全局变量，指向当前配置脚本的目录
```

## 完善配置

6. webpack loader

loader：本质上是一个函数，它的作用是将某个源码字符串转换成另一个源码字符串返回。

loader导出必须用commonJS导出，因为在打包过程中运行，来匹配相应模块

```js
module.exports = {
  module: { //针对模块的配置：rules，noPrase
    rules: [  //模块匹配规则
      {
        test: /\.js$/,  //匹配的模块正则
        use: [
          { //匹配到后应用的规则模块
            loader: "模块路径", //loader模块的路径，该字符串会被放置到require中
            options: {} //向对应loader传递的额外参数
          }
        ]
      }
    ]
  }
}
```


7. webpack plugin

plugin：本质是一个带有apply方法的对象,把功能嵌入到webpack的编译流程中

```js
class MyPlugin{
  apply(complier) {
    compiler.hooks.事件名称.事件类型(name, function(compilation){
      //事件处理函数
    })
  }
}

//在配置中应用
module.exports = {
  plugins: [
    new MyPlugin(
      //code
    )
  ]
}
```

webpack在编译开始会创建一个编译器对象complier,complier会调用plugin的apply方法，并吧complier传入方法,而打包的过程是由complication负责

8. 配置环境区分

创建三个配置脚本文件分别对应base,dev,prod环境,在webpack.config.js用函数方法返回配置对象

```js
const baseConfig = require('./build/base.config');
const prodConfig = require('./build/prod.config');
const devConfig = require('./build/dev.config');
module.exports = env => {
  if (env && env.prod) {
    return {
      ...baseConfig,
      ...prodConfig
    }
  } else {
    return {
      ...baseConfig,
      ...devConfig
    }
  }
}
```

```json
"scripts": {
  "prod": "webpack --env.prod",
  "dev": "webpack"
},
```

