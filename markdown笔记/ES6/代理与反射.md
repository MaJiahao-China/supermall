# Reflect

含义：‘反射’，反应js语法的底层实现。

## 概念

1. 放置`Object`对象的一些明显属于语言内部的方法 (`Object.defineProperty`)

2. 修改某些`Object`方法的返回结果

3. 使`Object`操作都变成函数行为 

- `name in obj` => `Reflect.has(obj, name)` 
- `delete obj[name]` => `Reflect.deleteProperty(obj, name)`

4. `Reflect`对象的方法与`Proxy`对象的方法一一对应

## 重要的静态方法

1. `Reflect.get(target, name, receiver)`

- 若 name 属性绑定了 getter 函数，则 receiver 可以绑定函数的 this。

2. `Reflect.set(target, name, value, receiver)`

- 当 proxy 拦截复制操作， reflect 完成赋值默认行为，若传入 receiver ，Reflect.set 会触发 proxy.defineProperty

```js
// 原理：Proxy.set 的 receiver 参数总是指向 Proxy 代理对象，那么 Reflect.set 就会给 Proxy 对象赋值，触发 Proxy.defineProperty
const obj = {
  a: 'a'
}
const proxyObj = new Proxy(obj, {
  set(target, key, value, receiver) {
    console.log('set');
    Reflect.set(target, key, value, receiver);
  },
  defineProperty(target, key, attribute) {
    console.log('define');
    Reflect.defineProperty(target, key, attribute);
  }
})

proxyObj.a = 'A';
//
```

# Proxy

含义：代理，拦截 js 底层实现，实现修改和过滤底层操作。

## 案例

1. 观察者模式

- 含义：函数自动观察数据对象，若对象变化则自动执行函数；
函数是观察者，对象是主体，变化是触发条件

```js
// 观察者队列
const queuedObservers = new Set();
const observe = fn => queuedObservers.add(fn);
// 代理主体对象
const observable = obj => new Proxy(obj, {set});
// 设置触发条件
function set(target, key, value, receiver) {
  const result = Reflect.set(target, key, value, receiver);
  queuedObservers.forEach(observer => observer());
} 
```

2. 生成各种 DOM 节点的通用函数dom

```js
const dom = new Proxy({}, {
  get(obj, key) {
    return function(...args) {
      const el = document.createElement(key)
      let attrs = null
      if (typeof args[0] === 'object') {
        attrs = args[0]
        for (const prop of Object.keys(attrs)) {
          el.setAttribute(prop, attrs[prop])
        }
      }
      args.forEach(child => {
        if (typeof child === 'string') {
          child = document.createTextNode(child)
          el.appendChild(child)
        } else if (child instanceof Element) {
          el.appendChild(child)
        }
      })
      return el
    }
  }
})


const content = dom.div({ id: 'library' },
  'my favorite ui library',
  dom.ul(
    dom.li('ant-design'),
    dom.li('element-ui'),
    dom.li('viewty')
  )
)

document.body.appendChild(content)
```
